#
# Copyright (c) 2008-2018 Haulmont.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

moduleVarSearch = def webModule = project(":${modulePrefix}-web")
moduleVarReplace =\
def webModule = project(":${modulePrefix}-web")\n\
def polymerClientModule = project(":${modulePrefix}-polymer-client")

moduleConfigureSearch = task undeploy(type: Delete, dependsOn: ":${modulePrefix}-web:cleanConf") {
moduleConfigureReplace = \
configure(polymerClientModule) {\n\
\tapply(plugin: 'cuba')\n\
\tapply(plugin: 'idea')\n\
\n\
\tapply(plugin: 'war')\n\
\tapply(plugin: 'maven')\n\
\n\
\tdef frontAppDir = "${modulePrefix}-front"\n\
\tdef mainBuildDir = 'build/es6-unbundled'\n\
\n\
\ttask installBowerPackages(type: NodeTask, dependsOn: npmInstall) {\n\
\t\tscript = file("node_modules/bower/bin/bower")\n\
\t\targs = ['install','-F']\n\
\t\tinputs.file "bower.json"\n\
\t\toutputs.dir "bower_components"\n\
\t}\n\
\n\
\ttask buildPolymer(type: NodeTask, dependsOn: installBowerPackages) {\n\
\t\tscript = file("node_modules/polymer-cli/bin/polymer")\n\
\t\targs = ['build']\n\
\t\tinputs.files fileTree('./') {\n\
\t\texclude 'build'\n\
\t}\n\
\toutputs.dir "build"\n\
\t}\n\
\n\
\tassemble.dependsOn buildPolymer\n\
\n\
\ttask deployUnbundled(type: Copy) {\n\
\t\tfrom file('./')\n\
\t\tinclude 'bower_components/**'\n\
\t\tinclude 'src/**'\n\
\t\tinto "$cuba.tomcat.dir/webapps/$frontAppDir"\n\
\t}\n\
\n\
\ttask deploy(type: Copy, dependsOn: [assemble, deployUnbundled]) {\n\
\t\tfrom file(mainBuildDir)\n\
\t\tinto "$cuba.tomcat.dir/webapps/$frontAppDir"\n\
\t}\n\
\n\
\twar {\n\
\t\tfrom file(mainBuildDir)\n\
\t}\n\
}\n\
\n\
task undeploy(type: Delete, dependsOn: ":${modulePrefix}-web:cleanConf") {


undeploySearch = delete("$cuba.tomcat.dir/webapps/${modulePrefix}")
undeployReplace =\
delete("$cuba.tomcat.dir/webapps/${modulePrefix}")\n\
delete("$cuba.tomcat.dir/webapps/${modulePrefix}-front")\n\
delete("$cuba.tomcat.dir/webapps/${modulePrefix}-front")

moduleRegistration=project(":${modulePrefix}-polymer-client").projectDir = new File(settingsDir, 'modules/polymer-client')